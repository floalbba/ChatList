# Схема базы данных ChatList

База данных: **SQLite** (файл `chatlist.db` в директории приложения).

---

## Таблица `prompts`

Хранит сохранённые промты (запросы пользователя).

| Поле      | Тип         | Описание                    |
|-----------|--------------|-----------------------------|
| id        | INTEGER      | Первичный ключ, автоинкремент |
| created_at| DATETIME     | Дата и время создания       |
| prompt    | TEXT         | Текст промта                |
| tags      | TEXT         | Теги (через запятую или JSON) |

**Индексы:** `created_at`, `tags` (для поиска и сортировки).

---

## Таблица `models`

Хранит настройки нейросетей. API-ключи хранятся в `.env`, в таблице — только имя переменной окружения.

| Поле      | Тип         | Описание                                      |
|-----------|--------------|-----------------------------------------------|
| id        | INTEGER      | Первичный ключ, автоинкремент                 |
| name      | TEXT         | Название модели (например, "GPT-4", "Claude") |
| api_url   | TEXT         | URL API (например, https://api.openai.com/v1/chat/completions) |
| api_id    | TEXT         | Имя переменной в .env с API-ключом (например, OPENAI_API_KEY) |
| is_active | INTEGER      | 1 — активна, 0 — отключена                    |
| model_type| TEXT         | Тип API: openai, deepseek, groq и т.д. (опционально) |

**Индексы:** `is_active` (для быстрого получения активных моделей).

---

## Таблица `results`

Хранит сохранённые пользователем результаты (строки, отмеченные чекбоксом).

| Поле       | Тип         | Описание                              |
|------------|--------------|---------------------------------------|
| id         | INTEGER      | Первичный ключ, автоинкремент        |
| prompt_id  | INTEGER      | Внешний ключ на prompts.id            |
| model_id   | INTEGER      | Внешний ключ на models.id             |
| model_name | TEXT         | Название модели на момент сохранения  |
| response   | TEXT         | Текст ответа модели                   |
| created_at | DATETIME     | Дата и время сохранения               |

**Индексы:** `prompt_id`, `model_id`, `created_at`.

**Внешние ключи:**
- `prompt_id` → `prompts(id)` (ON DELETE CASCADE — при удалении промта удаляются результаты)
- `model_id` → `models(id)` (ON DELETE SET NULL — при удалении модели model_id может обнуляться, model_name остаётся)

---

## Таблица `settings`

Хранит настройки программы в формате ключ-значение.

| Поле   | Тип    | Описание           |
|--------|--------|--------------------|
| key    | TEXT   | Ключ настройки (PK)|
| value  | TEXT   | Значение           |

**Примеры ключей:**
- `theme` — тема интерфейса (light/dark)
- `last_prompt_id` — последний выбранный промт
- `window_geometry` — размер и позиция окна

---

## Диаграмма связей

```
prompts (1) ──────────< results (N)
    │
    └── prompt_id

models (1) ───────────< results (N)
    │
    └── model_id

settings — независимая таблица
```

---

## Временная таблица (в памяти)

Не хранится в SQLite. Создаётся после каждого запроса и существует до:
- нажатия «Сохранить» (выбранные строки → `results`, таблица очищается);
- ввода нового промта (таблица пересоздаётся).

| Поле         | Тип    | Описание                    |
|--------------|--------|-----------------------------|
| model_name   | str    | Название модели             |
| response     | str    | Текст ответа                |
| selected     | bool   | Отмечен ли чекбоксом        |
| model_id     | int    | ID модели (для сохранения)  |

---

## Файл .env (вне БД)

Хранит API-ключи. Имена переменных соответствуют полю `api_id` в таблице `models`.

```
OPENAI_API_KEY=sk-...
DEEPSEEK_API_KEY=...
GROQ_API_KEY=...
```
